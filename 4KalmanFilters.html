
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Kalman filters &#8212; Kalman Filters and IMU</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '4KalmanFilters';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Battery output" href="4aExampleBatteryOutput.html" />
    <link rel="prev" title="Low Pass filters" href="3LowPassFilters.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="0Intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Kalman Filters and IMU - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Kalman Filters and IMU - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0Intro.html">
                    Kalman Filters and IMU
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1AverageFilters.html">Average filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="2MovingAverageFilters.html">Moving Average filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="3LowPassFilters.html">Low Pass filters</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Kalman filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="4aExampleBatteryOutput.html">Battery output</a></li>
<li class="toctree-l1"><a class="reference internal" href="4bExampleVelocityFromPosition.html">Velocity from position</a></li>
<li class="toctree-l1"><a class="reference internal" href="5IMU.html">Attitude using a gyroscope and accelarometer</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/MalachiHibbins/IMU" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/MalachiHibbins/IMU/issues/new?title=Issue%20on%20page%20%2F4KalmanFilters.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/4KalmanFilters.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Kalman filters</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dictionary">Dictionary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-step">Estimation step</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-step">Prediction step</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="kalman-filters">
<h1>Kalman filters<a class="headerlink" href="#kalman-filters" title="Link to this heading">#</a></h1>
<p><strong>A kalman filter compares the predicted state, <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span>, with measurments, <span class="math notranslate nohighlight">\(z_k\)</span>, to create an estimate of the true state, <span class="math notranslate nohighlight">\(\hat{x}_k\)</span></strong>. This section introduces the kalman filter, its alogirthm and why we use it.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Predictions and estimates are not intechangable when talking about kalman filters. A prediction is a forecast of the next state based on the previous state and the mathematical model. Whereas a estimate is an update of the predicted state once new measurements have been taken.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In all future sections we scalars will be written as plain text <span class="math notranslate nohighlight">\(a\)</span> and vectors will be written in bold <span class="math notranslate nohighlight">\(\boldsymbol{a}\)</span>. Here the symbols are context free so so are all in plain text.</p>
</div>
<section id="dictionary">
<h2>Dictionary<a class="headerlink" href="#dictionary" title="Link to this heading">#</a></h2>
<p>The kalman filter deals with the linear state model. Where the state evolves linearly according to <span class="math notranslate nohighlight">\(A\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-state">
<span class="eqno">(9)<a class="headerlink" href="#equation-state" title="Link to this equation">#</a></span>\[x_{k+1} = Ax_k + w_k\]</div>
<p>and the measurement can be described as:</p>
<div class="math notranslate nohighlight" id="equation-measurment">
<span class="eqno">(10)<a class="headerlink" href="#equation-measurment" title="Link to this equation">#</a></span>\[z_k = Hx_k + v_k \]</div>
<p>Where <span class="math notranslate nohighlight">\(w_k\)</span> and <span class="math notranslate nohighlight">\(v_k\)</span> are both distributed normally with mean <span class="math notranslate nohighlight">\(0\)</span>.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>When a forcing function is something external that <strong>deliberatlely</strong> changes how the system behaves. E.g. When modelling a car rolling down a hill the cars motion is determined by gravity and friction, by pressing the cars break you are externally changing the cars behaviour.</p>
</aside>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_k\)</span> is the actual (but unknown) state vector at time <span class="math notranslate nohighlight">\(t_k\)</span> e.g. the true position and velocity of a car. <span class="math notranslate nohighlight">\(x_k\)</span>. (<span class="math notranslate nohighlight">\(n\times 1\)</span> column vector).</p></li>
<li><p><span class="math notranslate nohighlight">\(z_k\)</span> is the measurment of the state from the sensor at time <span class="math notranslate nohighlight">\(t_k\)</span>, but contains noise and errors. (<span class="math notranslate nohighlight">\(m \times 1\)</span> column vector).</p></li>
<li><p><span class="math notranslate nohighlight">\(A\)</span> is the state transition matrix. <span class="math notranslate nohighlight">\(A\)</span> represents the “rules of motion” of the system. It describes how <span class="math notranslate nohighlight">\(\hat{x}_k\)</span> evolves from one time step to the next, assuming there is no external factors changing it (a forcing function). For example if you knew a cars velocity at time <span class="math notranslate nohighlight">\(t_k\)</span> you could use <span class="math notranslate nohighlight">\(A\)</span> to predict where it would be at time <span class="math notranslate nohighlight">\(t_{k+1}. (\)</span>n\times n$ matrix).</p></li>
<li><p><span class="math notranslate nohighlight">\(\hat{x}_k\)</span> and <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span> represent the best estimate and prediction of <span class="math notranslate nohighlight">\(x_k\)</span> respectivly. <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span> is a prediction of the next state based on the physics of the system which is modeled using <span class="math notranslate nohighlight">\(A\)</span>. <span class="math notranslate nohighlight">\(\hat{x}_k\)</span> is a updated estimate which blends the model based prediction <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span> and the measurment <span class="math notranslate nohighlight">\(z_k\)</span>. <span class="math notranslate nohighlight">\(\hat{x}_k\)</span> is the end output from the kalman filter.</p></li>
<li><p><span class="math notranslate nohighlight">\(H\)</span> is the state to measurement matrix. <span class="math notranslate nohighlight">\(H\)</span> is the translator between the system’s state and what can be measured. It explains how, if there were no noise or errors, the true state would appear in the sensor. E.g. if the model uses position to predict velocity but the sensor only measures position how <span class="math notranslate nohighlight">\(H\)</span> only picks out position. (<span class="math notranslate nohighlight">\(m \times n\)</span> matrix). We can estimate the measurment using <span class="math notranslate nohighlight">\(\hat{x}_k\)</span>:</p></li>
</ul>
<p>Here <span class="math notranslate nohighlight">\(v_k\)</span> dissapears since we ining <span class="math notranslate nohighlight">\(H\)</span>.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{z}^-_k\)</span> and <span class="math notranslate nohighlight">\(\hat{z}_k\)</span> is the what the model predicts and esimates our measurments should be respectivly:</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq-h-calculate">
<span class="eqno">(11)<a class="headerlink" href="#equation-eq-h-calculate" title="Link to this equation">#</a></span>\[ \begin{align}\begin{aligned}\hat{z}_k &amp;= H\hat{x}_k\\\hat{z}^-_k &amp;= H\hat{x}^-_k\end{aligned}\end{align} \]</div>
<p>Which is very useful for determining <span class="math notranslate nohighlight">\(H\)</span>.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(w_k\)</span> is the linear process noise vector or noise associated with the prediction. <span class="math notranslate nohighlight">\(w_k\)</span> is white sequence noise (random noise uncorrelated with time), which makes the models prediction imperfect. E.g. unexpected bumps in the road for a moving car. (<span class="math notranslate nohighlight">\(n \times 1\)</span> column vector).</p></li>
<li><p><span class="math notranslate nohighlight">\(v_k\)</span> is the linear measurement noise vector, noise associated that corrupts <span class="math notranslate nohighlight">\(z_k\)</span>. Even if the true state is fixed, our measurments can change due to sensor imperfections. E.g. temperature measurments using a thermometer will be slightly different each time you measure. (<span class="math notranslate nohighlight">\(m \times 1\)</span> column vector).</p></li>
<li><p><span class="math notranslate nohighlight">\(Q\)</span> is the covariance matrix of <span class="math notranslate nohighlight">\(w_k\)</span> i.e. how much the true state is expected to deviate from the predictions made by the state transition model. Large <span class="math notranslate nohighlight">\(Q\)</span> assumes the measurments are more reliable than the model and puts a larger weighting on <span class="math notranslate nohighlight">\(z_k\)</span> compared to <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span> when computing <span class="math notranslate nohighlight">\(\hat{x}_{k+1}\)</span>. Smaller Q puts more trust in the model <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span> compared to <span class="math notranslate nohighlight">\(z_k\)</span>.</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq-process-noise-cov">
<span class="eqno">(12)<a class="headerlink" href="#equation-eq-process-noise-cov" title="Link to this equation">#</a></span>\[Q_k = \mathbb{E}[w_k w_k^T]\]</div>
<p><span id="id1">[<a class="reference internal" href="#id8" title="Robert Grover Brown and Patrick Y. C. Hwang. Introduction to random signals and applied kalman filtering : with matlab exercises. 2012. URL: http://proquest.safaribooksonline.com/9780470609699.">BH12</a>]</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(R\)</span> is the covariance matrix of <span class="math notranslate nohighlight">\(v_k\)</span>. i.e. how much the measured state is effected by noise in the state transition model. <span class="math notranslate nohighlight">\(R\)</span> tells the kalman filter how much to “trust” the measurments compared to model predictions.  Large <span class="math notranslate nohighlight">\(R\)</span> suggests the model is more reliable than the measurments and puts more emphasis on <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span> compared to <span class="math notranslate nohighlight">\(z_k\)</span> when computing <span class="math notranslate nohighlight">\(\hat{x}_{k+1}\)</span>, small <span class="math notranslate nohighlight">\(R\)</span> puts more emphasis on <span class="math notranslate nohighlight">\(z_k\)</span> compared to <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span>.</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq-measurement-noise-cov">
<span class="eqno">(13)<a class="headerlink" href="#equation-eq-measurement-noise-cov" title="Link to this equation">#</a></span>\[R_k = \mathbb{E}[v_k v_k^T]\]</div>
<p><span id="id2">[<a class="reference internal" href="#id8" title="Robert Grover Brown and Patrick Y. C. Hwang. Introduction to random signals and applied kalman filtering : with matlab exercises. 2012. URL: http://proquest.safaribooksonline.com/9780470609699.">BH12</a>]</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(e_k\)</span> and <span class="math notranslate nohighlight">\(e^-_k\)</span> are the error in the estimation and the error in the prediction respectivly defined as <span class="math notranslate nohighlight">\(e_k = x_k-\hat{x}_k\)</span> and <span class="math notranslate nohighlight">\(e^-_k = x_k-\hat{x}^-_k\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(P_k\)</span> and <span class="math notranslate nohighlight">\(P^-_k\)</span> are the associated error covariance matricies for <span class="math notranslate nohighlight">\(e_k\)</span> and <span class="math notranslate nohighlight">\(e^-_k\)</span> respectivly defined by:</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq-estimation-cov">
<span class="eqno">(14)<a class="headerlink" href="#equation-eq-estimation-cov" title="Link to this equation">#</a></span>\[P_k = \mathbb{E}[e_k e_k^T]\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-eq-prediction-cov">
<span class="eqno">(15)<a class="headerlink" href="#equation-eq-prediction-cov" title="Link to this equation">#</a></span>\[P^-_k = \mathbb{E}[e^-_k (e^-_k)^T]\]</div>
<p><span id="id3">[<a class="reference internal" href="#id8" title="Robert Grover Brown and Patrick Y. C. Hwang. Introduction to random signals and applied kalman filtering : with matlab exercises. 2012. URL: http://proquest.safaribooksonline.com/9780470609699.">BH12</a>]</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(K_k\)</span> is the kalman gain which has similar effects to <span class="math notranslate nohighlight">\(\alpha\)</span> in the low pass filter.</p></li>
<li><p><span class="math notranslate nohighlight">\(x_0\)</span> is the initial state estimate. provided at the start of the estimation process.</p></li>
<li><p><span class="math notranslate nohighlight">\(P_0\)</span> is the initial error covarance matrix estimate.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The kalman filter parameters are the parameters set by the user before fitting the data they are: <span class="math notranslate nohighlight">\(A\)</span>, <span class="math notranslate nohighlight">\(Q\)</span>, <span class="math notranslate nohighlight">\(H\)</span>, <span class="math notranslate nohighlight">\(R\)</span>, <span class="math notranslate nohighlight">\(\hat{x}_0\)</span> and <span class="math notranslate nohighlight">\(P_0\)</span>.</p>
</div>
</section>
<section id="estimation-step">
<h2>Estimation step<a class="headerlink" href="#estimation-step" title="Link to this heading">#</a></h2>
<p>The prediction <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span> and measuremnt are combined using the blending factor <span class="math notranslate nohighlight">\(K_k\)</span> (yet to be determined) below to determine the updated estimate <span class="math notranslate nohighlight">\(\hat{x}_k\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-eq-kalman-update">
<span class="eqno">(16)<a class="headerlink" href="#equation-eq-kalman-update" title="Link to this equation">#</a></span>\[\hat{x}_k = \hat{x}^-_k + K_k(z_k - H\hat{x}^-_k)\]</div>
<p>this is known as the <strong>update step</strong> <span class="math notranslate nohighlight">\(K_k\)</span> determines how much of each <span class="math notranslate nohighlight">\(z_k\)</span> and <span class="math notranslate nohighlight">\(\hat{x}^-_k\)</span> goes into <span class="math notranslate nohighlight">\(\hat{x}_k\)</span> i.e. how much we comparatively trust the measurement and the prediction.</p>
<div class="admonition-asside-connection-between-kalman-filter-and-low-pass-filter admonition">
<p class="admonition-title">Asside: Connection between kalman filter and low pass filter</p>
<p>Equation <a class="reference internal" href="#equation-eq-kalman-update">(16)</a> can be rewritten as:</p>
<div class="math notranslate nohighlight" id="equation-eq-kalman-lowpass">
<span class="eqno">(17)<a class="headerlink" href="#equation-eq-kalman-lowpass" title="Link to this equation">#</a></span>\[\hat{x}_k = (\mathbb{I} + K_k H)\hat{x}^-_k + K_k z_k\]</div>
<p>Letting <span class="math notranslate nohighlight">\(H = \mathbb{I}\)</span> and <span class="math notranslate nohighlight">\(\alpha= 1-K_k\)</span> a first order low pass filter is recovered similar to <a class="reference internal" href="3LowPassFilters.html#equation-eq-lowpass-2">(7)</a>.</p>
<div class="math notranslate nohighlight" id="equation-eq-kalman-alpha">
<span class="eqno">(18)<a class="headerlink" href="#equation-eq-kalman-alpha" title="Link to this equation">#</a></span>\[\hat{x}_k = \alpha \hat{x}^-_{k} + (1 - \alpha) z_k\]</div>
<p>A low pass filter smooths out noisy data by blending the previous estimate with new data using a fixed weighting factor <span class="math notranslate nohighlight">\(\alpha\)</span>. The Kalman fitler aultomatically adjusts its version of <span class="math notranslate nohighlight">\(\alpha\)</span> essentially <span class="math notranslate nohighlight">\(K_k\)</span> to decide how to weight the previous estimate and the new data for each time step depending on how much uncertainty there is in the prediction and measurment.</p>
</div>
<p>The mean square error (MSE) between <span class="math notranslate nohighlight">\(\hat{x}_k\)</span> and <span class="math notranslate nohighlight">\(x_k\)</span> is the performance criterion for the kalman filter. The MSE is related to the terms in the leading diagonal of <span class="math notranslate nohighlight">\(P_k\)</span>. Here we will derive an expression for <span class="math notranslate nohighlight">\(K_k\)</span> which minimises the MSE. We want to obtain an expression from the defenition of <span class="math notranslate nohighlight">\(P_k\)</span> from <a class="reference internal" href="#equation-eq-estimation-cov">(14)</a> in terms of our kalman parameters. The problem is <a class="reference internal" href="#equation-eq-estimation-cov">(14)</a> contains <span class="math notranslate nohighlight">\(e_k\)</span> which we can’t compute as we don’t know <span class="math notranslate nohighlight">\(x_k\)</span>.</p>
<p>First lets determine an expression for <span class="math notranslate nohighlight">\(\hat{x}_k\)</span> by subbing <a class="reference internal" href="#equation-measurment">(10)</a> into <a class="reference internal" href="#equation-eq-kalman-update">(16)</a>, to rewrite our estimation update equation:</p>
<div class="math notranslate nohighlight" id="equation-eq-intermediate-step">
<span class="eqno">(19)<a class="headerlink" href="#equation-eq-intermediate-step" title="Link to this equation">#</a></span>\[\hat{x}_k = \hat{x}^-_k + K_k(Hx_k+v_k-H\hat{x}^-_k)\]</div>
<p>then lets use this in our expression for <span class="math notranslate nohighlight">\(P_k\)</span> by subbing <a class="reference internal" href="#equation-eq-intermediate-step">(19)</a> into <a class="reference internal" href="#equation-eq-estimation-cov">(14)</a>:</p>
<div class="math notranslate nohighlight" id="equation-eq-expectation">
<span class="eqno">(20)<a class="headerlink" href="#equation-eq-expectation" title="Link to this equation">#</a></span>\[P_k = \mathbb{E} \left\{ 
\left[ 
(x_k - \hat{x}_k^-) - K_k \left( H_k {x}_k + v_k - H_k \hat{x}_k^- \right)
\right]
\left[ 
(x_k - \hat{x}_k^-) - K_k \left( H_k {x}_k + v_k - H_k \hat{x}_k^- \right)
\right]^T
\right\}\]</div>
<div class="admonition-in-depth-expectation-simplification admonition">
<p class="admonition-title">In depth expectation simplification</p>
<p>By comparing <a class="reference internal" href="#equation-eq-expectation">(20)</a> and <a class="reference internal" href="#equation-eq-estimation-cov">(14)</a> we see that the estimation error <span class="math notranslate nohighlight">\(e_k\)</span> is built from the error in our prediction and the error effect of measurment noise. The estimation error after the update step is:</p>
<div class="math notranslate nohighlight" id="equation-eq-e1">
<span class="eqno">(21)<a class="headerlink" href="#equation-eq-e1" title="Link to this equation">#</a></span>\[e_k = (x_k - \hat{x}_k^-) - K_k \left( H_k {x}_k + v_k - H_k \hat{x}_k^- \right)\]</div>
<p>So we start with the difference between our true state and our prediction. The kalman gain adjusts this based on what we actually measure <span class="math notranslate nohighlight">\(z_k = H_k {x}_k + v_k\)</span> and what we are expected to measure <span class="math notranslate nohighlight">\(\hat{z} = H_k \hat{x}_k^-\)</span> based on the model.
We can group the terms more intuitivly by substituting in the defenition for the prediction error <span class="math notranslate nohighlight">\(e^-_k = x_k - \hat{x}_k^-\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-eq-e2">
<span class="eqno">(22)<a class="headerlink" href="#equation-eq-e2" title="Link to this equation">#</a></span>\[e_k = e^-_k \Omega_k - K_kv_k\]</div>
<p>Where <span class="math notranslate nohighlight">\(\Omega_k = I - K_k H_k\)</span> describes how much of the prediction error remains after the update. To better undesrtand how uncertain out new estimate is lets return to the covariance of <span class="math notranslate nohighlight">\(e_k\)</span> by subbing <a class="reference internal" href="#equation-eq-e2">(22)</a> into <a class="reference internal" href="#equation-eq-estimation-cov">(14)</a>:</p>
<div class="math notranslate nohighlight" id="equation-eq-e3">
<span class="eqno">(23)<a class="headerlink" href="#equation-eq-e3" title="Link to this equation">#</a></span>\[P_k = \mathbb{E}[(e^-_k \Omega_k - K_kv_k)(e^-_k\Omega_k - K_kv_k)^T]\]</div>
<p>When we expand the brackets we get four terms:</p>
<div class="math notranslate nohighlight" id="equation-eq-e4">
<span class="eqno">(24)<a class="headerlink" href="#equation-eq-e4" title="Link to this equation">#</a></span>\[P_k = \mathbb{E}[ 
\Omega_k, e^-_k (e^-_k)^T \Omega_k^T 
- \Omega_k, e^-_k v^T K_k^T 
- K_k v (e^-_k)^T \Omega^T 
+ K_k v v^T K_k^T]\]</div>
<p>Then using the identity <span class="math notranslate nohighlight">\(\mathbb{E}[Ax + By] \equiv A\mathbb{E}[x] + B \mathbb{E}[y]\)</span> we can rewrite <a class="reference internal" href="#equation-eq-e4">(24)</a></p>
<div class="math notranslate nohighlight" id="equation-eq-e5">
<span class="eqno">(25)<a class="headerlink" href="#equation-eq-e5" title="Link to this equation">#</a></span>\[P_k =  
\Omega_k, \mathbb{E}[e^-_k (e^-_k)^T] \Omega_k^T 
- \Omega_k \mathbb{E}[e^-_k v^T] K_k^T
- K_k \mathbb{E}[v (e^-_k)^T] \Omega^T 
+ K_k \mathbb{E}[v v^T] K_k^T\]</div>
<p>The first term represents the uncertainty left from the prediction after the update. The last term represents the uncertainty added by the measurment noise. The two middle terms repersent the interaction between the prediction error and the mearuement noise they are both zero since <span class="math notranslate nohighlight">\(e_k\)</span> and <span class="math notranslate nohighlight">\(v_k\)</span> are both have mean of 0 and are independent. Subbing in <a class="reference internal" href="#equation-eq-prediction-cov">(15)</a> into the first term, <a class="reference internal" href="#equation-eq-measurement-noise-cov">(13)</a> into the last and our defenition of <span class="math notranslate nohighlight">\(\Omega_k\)</span> term gets <a class="reference internal" href="#equation-p-k-minimise">(26)</a>.</p>
</div>
<p>After performing the expectation we are left with an equation for <span class="math notranslate nohighlight">\(P_k\)</span> in terms of kalman filter parameters:</p>
<div class="math notranslate nohighlight" id="equation-p-k-minimise">
<span class="eqno">(26)<a class="headerlink" href="#equation-p-k-minimise" title="Link to this equation">#</a></span>\[P_k = (I-K_kH_k)P^-_k(I-K_kH_k)^T+K_kR_kK^T_k\]</div>
<p>Which is a general expression for the updated error covariance matrix for subpotimal <span class="math notranslate nohighlight">\(K_k\)</span>. Now we will optimise <span class="math notranslate nohighlight">\(K_k\)</span> by minimising the MSE corresponding to finding the value of <span class="math notranslate nohighlight">\(K_k\)</span> that minises the individual terms along the leading diagonal of <span class="math notranslate nohighlight">\(P_k\)</span> as these terms represent the estimation error variances for the elements of the state vector elements being selected. This leaves:</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>For a more detailed derivation see <span id="id4">[<a class="reference internal" href="#id8" title="Robert Grover Brown and Patrick Y. C. Hwang. Introduction to random signals and applied kalman filtering : with matlab exercises. 2012. URL: http://proquest.safaribooksonline.com/9780470609699.">BH12</a>]</span>.</p>
</aside>
<div class="math notranslate nohighlight" id="equation-eq-kalman-gain">
<span class="eqno">(27)<a class="headerlink" href="#equation-eq-kalman-gain" title="Link to this equation">#</a></span>\[K_k = P^-_k H^T (H P^-_k H^T + R)^{-1}\]</div>
<p>In this case <span class="math notranslate nohighlight">\(K_k\)</span> is the optimum kalman gain. When considering the optimum kalman gain <a class="reference internal" href="#equation-p-k-minimise">(26)</a> can be simplified to by ignoring the last two terms:</p>
<div class="math notranslate nohighlight" id="equation-eq-error-covariance-update">
<span class="eqno">(28)<a class="headerlink" href="#equation-eq-error-covariance-update" title="Link to this equation">#</a></span>\[P_k = P^-_k - K_k H P^-_k\]</div>
<p><span id="id5">[<a class="reference internal" href="#id8" title="Robert Grover Brown and Patrick Y. C. Hwang. Introduction to random signals and applied kalman filtering : with matlab exercises. 2012. URL: http://proquest.safaribooksonline.com/9780470609699.">BH12</a>]</span></p>
<p>Whereas the low pass filter passes <span class="math notranslate nohighlight">\(\hat{x}_{k-1}\)</span> directly between time steps <span class="math notranslate nohighlight">\(t_{k-1}\)</span> and <span class="math notranslate nohighlight">\(t_{k}\)</span> the kalman filter predicts the next step before a measurement is carried out and compares this with the measurement to give new estimate.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><span class="math notranslate nohighlight">\(H\)</span> and <span class="math notranslate nohighlight">\(R\)</span> are only used in the prediction step.</p>
</div>
</section>
<section id="prediction-step">
<h2>Prediction step<a class="headerlink" href="#prediction-step" title="Link to this heading">#</a></h2>
<p>Unlike the low pass filter Kalman filters also consider the physics of the system, the predictions which are used alongside measurments for state estimation. The system dynamically changes over time and is modelled using <span class="math notranslate nohighlight">\(A\)</span>, which describes how the state is predicted to change between <span class="math notranslate nohighlight">\(t_k\)</span> and <span class="math notranslate nohighlight">\(t_{k+1}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-projection">
<span class="eqno">(29)<a class="headerlink" href="#equation-projection" title="Link to this equation">#</a></span>\[\hat{x}^-_{k+1} = A_k \hat{x}_k\]</div>
<p>The error covariance matrix associated with this prediction <span class="math notranslate nohighlight">\(\hat{x}^-_{k+1}\)</span> is obtained from:</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>If <span class="math notranslate nohighlight">\(\mu_x\)</span> is transformed linearly <span class="math notranslate nohighlight">\(\mu_y = F\mu_x\)</span> its covariance matrix, <span class="math notranslate nohighlight">\(\Sigma_x\)</span>, can be transformed using <span class="math notranslate nohighlight">\(\Sigma_y = F\Sigma_xF^T\)</span>. <span id="id6">[<a class="reference internal" href="#id9" title="Armando Barreto, Malek Adjouadi, Francisco R. Ortega, and Nonnarit O-larnnithipong. &quot;intuitive understanding of kalman filtering with matlab&quot;. 2021. URL: https://public.ebookcentral.proquest.com/choice/publicfullrecord.aspx?p=6236305, doi:10.1201/9780429200656.">BAOOl21</a>]</span></p>
</aside>
<div class="math notranslate nohighlight" id="equation-projection-covariance">
<span class="eqno">(30)<a class="headerlink" href="#equation-projection-covariance" title="Link to this equation">#</a></span>\[P_k = A_kP_kA_k^T+Q\]</div>
<p><span class="math notranslate nohighlight">\(Q\)</span> also appears here as this is how much the true state is expected to vary from the predictions. Together these two equations encode the prediction phase of the filter.  If we only had a model we wouldn’t need the estimation phase i.e. we had no measurments.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> are only used in the prediction step.</p>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<figure class="align-default" id="fig-kalman-block-diagram">
<img alt="_images/BasicKalman.jpg" src="_images/BasicKalman.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Block diagram of the Kalman filter process.</span><a class="headerlink" href="#fig-kalman-block-diagram" title="Link to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(H\)</span> are essential for the kalman filter if these are incorrect the filter will not converge.</p></li>
<li><p><span class="math notranslate nohighlight">\(Q\)</span> and <span class="math notranslate nohighlight">\(R\)</span> are used for tuning and ensure an optimum fit.</p></li>
<li><p><span class="math notranslate nohighlight">\(x_0\)</span> and <span class="math notranslate nohighlight">\(P_0\)</span> are initial estimates the filter will still converge even if these are wrong.</p></li>
<li><p><span class="math notranslate nohighlight">\(K_k\)</span> and <span class="math notranslate nohighlight">\(P_k\)</span> are internal parameters.</p></li>
<li><p><span class="math notranslate nohighlight">\(z_k\)</span> are the inputs (measured state)</p></li>
<li><p><span class="math notranslate nohighlight">\(\hat{x}_k\)</span> are the outputs (estimated state)</p></li>
</ul>
<div class="docutils container" id="id7">
<div role="list" class="citation-list">
<div class="citation" id="id9" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">BAOOl21</a><span class="fn-bracket">]</span></span>
<p>Armando Barreto, Malek Adjouadi, Francisco R. Ortega, and Nonnarit O-larnnithipong. &quot;intuitive understanding of kalman filtering with matlab&quot;. 2021. URL: <a class="reference external" href="https://public.ebookcentral.proquest.com/choice/publicfullrecord.aspx?p=6236305">https://public.ebookcentral.proquest.com/choice/publicfullrecord.aspx?p=6236305</a>, <a class="reference external" href="https://doi.org/10.1201/9780429200656">doi:10.1201/9780429200656</a>.</p>
</div>
<div class="citation" id="id8" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>BH12<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>,<a role="doc-backlink" href="#id3">3</a>,<a role="doc-backlink" href="#id4">4</a>,<a role="doc-backlink" href="#id5">5</a>)</span>
<p>Robert Grover Brown and Patrick Y. C. Hwang. Introduction to random signals and applied kalman filtering : with matlab exercises. 2012. URL: <a class="reference external" href="http://proquest.safaribooksonline.com/9780470609699">http://proquest.safaribooksonline.com/9780470609699</a>.</p>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="3LowPassFilters.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Low Pass filters</p>
      </div>
    </a>
    <a class="right-next"
       href="4aExampleBatteryOutput.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Battery output</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dictionary">Dictionary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-step">Estimation step</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-step">Prediction step</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Malachi Hibbins
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>