# Example: Velocity from position
- $n = 2$ since $x_k = \begin{bmatrix}
s \\
v
\end{bmatrix}_k$ where $s$ is the position and $v$ is the velocity.
- $m = 1$ since $z_k = s_k$

- $A = 
\begin{bmatrix}
1 & \Delta t \\
0 & 1
\end{bmatrix}$ where ($\Delta t$ is the time step between measurements) since $x_{k+1} = \begin{bmatrix}
s_k + v_k\Delta t \\ v_k 
\end{bmatrix} = Ax_k$
- $H = \begin{bmatrix}
1 &
0
\end{bmatrix}$ since $z_{k+1} = Hx_k + v_k$
- Q is given $Q = \begin{bmatrix}
Q_s & 0 \\
0 & Q_v
\end{bmatrix} = \begin{bmatrix}
1 & 0 \\
0 & 3
\end{bmatrix}$ Where $Q_s$ is the covariance in $s_k$ and $Q_v$ is the covariance in $v_k$.
- $R$ is one dimensional and is obtained by tuning.
```{important}
The true signal in the graphs below is generated using a combination of $\sin$ waves of varing amplitudes and speeds, the velocity version is the analytical deriative of this. The noisy signal is generated by adding randomly generated values to this using the guassian distribution. The kalman filter is applied to the noisy position data and outputs the filtred postion data and filtered velocity data. Which are graphed below
```
```{Note}
The summary statistics are generated between the true signal and the kalman filtered signal. $\mu^2$ refers to the random mean squared error and $\mu$ refers to the mean absolute error.
```
```{figure} image-23.png
:name: original
Kaman filter setup using parameters above to fit a noisy signal made up from sin waves with varing amplitudes and periods.
```
The fit for the position is very good with high R$^2$ value. However it could be smoother and the residules graph is not completely random suggesting there could be some delay, prehaps increasing $R$ would improve the fit. The velocity fit is poor and the filtered signal lags behind the true signal. Since only the velocity signal is lagging Q_v was increased.

```{figure} image-24.png
:name: increased-R-and-increased-Q
{numref}`original` with increased R and increased Q
```

Figure {numref}`increased-R-and-increased-Q` shows a slightly improved fit with position and a significantly improved fit with velocity. However the velocity fit is now significantly less smooth, there is a clear tradeoff between having a a smooth fit and having an accurate fit. Smoother fits more accurately represent the true shape of the data, but will often cause there to be a delay. The residuals graph for position now seems to be very random implying close to optimal fit, the residuals graph for velocity is close to being random.

```{admonition} Question
How is it possible to ensure both a smooth fit whilst minimising lag and ensuring a good fit? Prehaps a machine learning algorithm?
```

```{note}
Using a kalmamn filter for differentiation is significantly more accurate than performing numerical integration on the noisy signal. 
```

```{figure} image-27.png
:label: Classic-Kalman
Diagram of the inputs of the kalman filter without sensor fusion e.g. example two using velocity to calculate acceleration.
```